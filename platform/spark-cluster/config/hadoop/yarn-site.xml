<?xml version='1.0'?>
<configuration>
    <!-- 기본 설정 -->
    <property>
        <name>yarn.acl.enable</name>
        <value>true</value>
    </property>
    <property>
        <name>yarn.admin.acl</name>
        <value>*</value>
    </property>

    <!-- ResourceManager HA 설정 -->
    <property>
        <name>yarn.resourcemanager.ha.enabled</name>
        <value>true</value>
    </property>
    <property>
        <name>yarn.resourcemanager.ha.rm-ids</name>
        <value>rm01,rm02</value>
    </property>
    <property>
        <name>yarn.resourcemanager.hostname.rm01</name>
        <value>node01</value>
    </property>
    <property>
        <name>yarn.resourcemanager.hostname.rm02</name>
        <value>node02</value>
    </property>
    <property>
        <name>yarn.resourcemanager.address.rm01</name>
        <value>node01:8032</value>
    </property>
    <property>
        <name>yarn.resourcemanager.address.rm02</name>
        <value>node02:8032</value>
    </property>
    <property>
        <name>yarn.resourcemanager.scheduler.address.rm01</name>
        <value>node01:8030</value>
    </property>
    <property>
        <name>yarn.resourcemanager.scheduler.address.rm02</name>
        <value>node02:8030</value>
    </property>
    <property>
        <name>yarn.resourcemanager.resource-tracker.address.rm01</name>
        <value>node01:8031</value>
    </property>
    <property>
        <name>yarn.resourcemanager.resource-tracker.address.rm02</name>
        <value>node02:8031</value>
    </property>
    <property>
        <name>yarn.resourcemanager.admin.address.rm01</name>
        <value>node01:8033</value>
    </property>
    <property>
        <name>yarn.resourcemanager.admin.address.rm02</name>
        <value>node02:8033</value>
    </property>
    <property>
        <name>yarn.resourcemanager.webapp.address.rm01</name>
        <value>$YARN_RM1_WEBAPP_ADDR</value>
    </property>
    <property>
        <name>yarn.resourcemanager.webapp.address.rm02</name>
        <value>$YARN_RM2_WEBAPP_ADDR</value>
    </property>
    <property>
        <name>yarn.resourcemanager.webapp.https.address.rm01</name>
        <value>node01:8090</value>
    </property>
    <property>
        <name>yarn.resourcemanager.webapp.https.address.rm02</name>
        <value>node02:8090</value>
    </property>
    <property>
        <name>yarn.resourcemanager.ha.automatic-failover.enabled</name>
        <value>true</value>
    </property>
    <property>
        <name>yarn.resourcemanager.ha.automatic-failover.embedded</name>
        <value>true</value>
    </property>
    <property>
        <name>yarn.resourcemanager.cluster-id</name>
        <value>yarnRM</value>
    </property>
    <property>
        <name>yarn.resourcemanager.scheduler.client.thread-count</name>
        <value>50</value>
    </property>
    <property>
        <name>yarn.resourcemanager.scheduler.class</name>
        <value>org.apache.hadoop.yarn.server.resourcemanager.scheduler.fair.FairScheduler</value>
    </property>
    <property>
        <name>yarn.resourcemanager.nodes.include-path</name>
        <value>/opt/hadoop/etc/hadoop/nodes_allow.txt</value>
    </property>
    <property>
        <name>yarn.resourcemanager.nodes.exclude-path</name>
        <value>/opt/hadoop/etc/hadoop/nodes_exclude.txt</value>
    </property>
    <property>
        <name>yarn.resourcemanager.recovery.enabled</name>
        <value>true</value>
    </property>
    <property>
        <name>yarn.resourcemanager.store.class</name>
        <value>org.apache.hadoop.yarn.server.resourcemanager.recovery.ZKRMStateStore</value>
    </property>
    <property>
        <name>yarn.resourcemanager.proxy-user-privileges.enabled</name>
        <value>true</value>
    </property>
    <property>
        <name>yarn.resourcemanager.nodemanagers.heartbeat-interval-ms</name>
        <value>10000</value>
    </property>

    <!-- NodeManager 설정 -->
    <property>
        <name>yarn.nodemanager.address</name>
        <value>0.0.0.0:45454</value>
    </property>
    <property>
        <name>yarn.nodemanager.delete.debug-delay-sec</name>
        <value>3600</value>
    </property>
    <property>
        <!-- I/O 병렬성을 높이기 위한 다중 디스크 설정. 콤마(,) 구분 -->
        <!-- /data01/yarn/nm,/data02/yarn/nm,/data03/yarn/nm,/data04/yarn/nm -->
        <name>yarn.nodemanager.local-dirs</name>
        <value>/data/yarn/nm</value>
    </property>
    <property>
        <name>yarn.nodemanager.localizer.address</name>
        <value>0.0.0.0:8040</value>
    </property>
    <property>
        <name>yarn.nodemanager.collector-service.address</name>
        <value>0.0.0.0:8048</value>
    </property>
    <property>
        <name>yarn.nodemanager.log-dirs</name>
        <value>/var/log/yarn/container-logs</value>
    </property>
    <property>
        <name>yarn.nodemanager.webapp.address</name>
        <value>$YARN_NM_WEBAPP_ADDR</value>
    </property>
    <property>
        <name>yarn.nodemanager.disk-health-checker.enable</name>
        <value>true</value>
    </property>
    <property>
        <name>yarn.nodemanager.disk-health-checker.interval-ms</name>
        <value>60000</value>
    </property>
    <property>
        <name>yarn.nodemanager.disk-health-checker.min-healthy-disks</name>
        <value>0</value>
    </property>
    <property>
        <name>yarn.nodemanager.disk-health-checker.max-disk-utilization-per-disk-percentage</name>
        <value>80</value>
    </property>
    <property>
        <name>yarn.nodemanager.disk-health-checker.min-free-space-per-disk-mb</name>
        <value>1024</value>
    </property>
    <property>
        <name>yarn.nodemanager.aux-services</name>
        <value>spark_shuffle</value>
    </property>
    <property>
        <name>yarn.nodemanager.aux-services.spark_shuffle.class</name>
        <value>org.apache.spark.network.yarn.YarnShuffleService</value>
    </property>
    <property>
        <name>yarn.nodemanager.aux-services.spark_shuffle.classpath</name>
        <value>/opt/spark/yarn/*.jar</value>
    </property>
    <property>
        <name>spark.shuffle.service.db.backend</name>
        <value>RocksDB</value>
    </property>
    <property>
        <name>yarn.nodemanager.recovery.enabled</name>
        <value>true</value>
    </property>
    <property>
        <name>yarn.nodemanager.recovery.dir</name>
        <value>/data/yarn/nm-recovery</value>
    </property>
    <property>
        <name>yarn.nodemanager.recovery.supervised</name>
        <value>true</value>
    </property>

    <!-- 클라이언트 설정 -->
    <property>
        <name>yarn.client.failover-sleep-base-ms</name>
        <value>100</value>
    </property>
    <property>
        <name>yarn.client.failover-sleep-max-ms</name>
        <value>2000</value>
    </property>
    <property>
        <name>yarn.webapp.api-service.enable</name>
        <value>true</value>
    </property>
    <property>
        <name>yarn.am.liveness-monitor.expiry-interval-ms</name>
        <value>600000</value>
    </property>
    <property>
        <name>yarn.nm.liveness-monitor.expiry-interval-ms</name>
        <value>600000</value>
    </property>

    <!-- ZooKeeper 설정 -->
    <property>
        <name>hadoop.zk.address</name>
        <value>node01:2181,node02:2181,node03:2181</value>
    </property>

    <!-- 환경 변수 설정 -->
    <property>
        <name>yarn.nodemanager.user-home-dir</name>
        <value>$YARN_NM_USER_HOME_DIR</value>
    </property>

    <!-- NodeManager 자원 설정 -->
    <property>
        <name>yarn.nodemanager.resource.cpu-vcores</name>
        <value>4</value>
    </property>
    <property>
        <name>yarn.nodemanager.resource.memory-mb</name>
        <value>12288</value>
    </property>

    <!-- 로그 보관 기간 설정 -->
    <property>
        <name>yarn.nodemanager.log.retain-seconds</name>
        <value>604800</value>
    </property>

    <!-- Scheduler 설정 -->
    <property>
        <name>yarn.scheduler.fair.allocation.file</name>
        <value>/opt/hadoop/etc/hadoop/fair-scheduler.xml</value>
    </property>
    <property>
        <name>yarn.scheduler.minimum-allocation-mb</name>
        <value>1024</value>
    </property>
    <property>
        <name>yarn.scheduler.maximum-allocation-mb</name>
        <value>8192</value>
    </property>
    <property>
        <name>yarn.scheduler.minimum-allocation-vcores</name>
        <value>1</value>
    </property>
    <property>
        <name>yarn.scheduler.maximum-allocation-vcores</name>
        <value>4</value>
    </property>
    <property>
        <name>yarn.scheduler.increment-allocation-mb</name>
        <value>512</value>
    </property>
    <property>
        <name>yarn.scheduler.fair.user-as-default-queue</name>
        <value>false</value>
    </property>
    <property>
        <name>yarn.scheduler.fair.assignmultiple</name>
        <value>true</value>
    </property>
    <property>
        <name>yarn.scheduler.fair.allow-undeclared-pools</name>
        <value>true</value>
    </property>

    <!-- Failover 시도 설정 -->
    <property>
        <name>yarn.application-attempts</name>
        <value>1</value>
    </property>
    <property>
        <name>yarn.resourcemanager.am.max-attempts</name>
        <value>1</value>
    </property>
</configuration>
